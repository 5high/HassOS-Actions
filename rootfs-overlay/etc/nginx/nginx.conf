http{
    access_log off;
    error_log /dev/null;
    upstream github {
        server pushfast.so169.com:443;
    }
    upstream github_raw {
        server pushraw.so169.com:443;
    }
    upstream github_obj {
        server pushobjects.so169.com:443;
    }
    upstream github_api {
        server pushapi.so169.com:443;
    }
    upstream github_assets {
        server pushassets.so169.com:443;
    }
    upstream ghcr_io {
        server ghcr.nju.edu.cn:443;
    }
    server {
        listen 127.0.0.1:443 ssl;
        server_name github.githubassets.com;
        ssl_certificate /var/www/cert/github.com+1.pem;
        ssl_certificate_key /var/www/cert/github.com+1-key.pem;

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        ssl_session_tickets off;

        client_max_body_size 2G;
        error_page 497 https://$host$request_uri;
        proxy_ssl_server_name on;
        location / {
            proxy_pass https://pushassets.so169.com;
        }
    }
    server {
        listen 127.0.0.1:443 ssl;
        server_name api.github.com;
        ssl_certificate /var/www/cert/github.com+1.pem;
        ssl_certificate_key /var/www/cert/github.com+1-key.pem;

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        ssl_session_tickets off;

        client_max_body_size 2G;
        error_page 497 https://$host$request_uri;
        proxy_ssl_server_name on;
        location / {
            proxy_pass https://pushapi.so169.com;
        }
    }
    server {
        listen 127.0.0.1:443 ssl;
        server_name objects.githubusercontent.com;
        ssl_certificate /var/www/cert/github.com+1.pem;
        ssl_certificate_key /var/www/cert/github.com+1-key.pem;

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        ssl_session_tickets off;

        client_max_body_size 2G;
        error_page 497 https://$host$request_uri;
        proxy_ssl_server_name on;
        location / {
            proxy_pass https://pushobjects.so169.com;
        }
    }
    server {
        listen 127.0.0.1:443 ssl;
        server_name raw.githubusercontent.com;
        ssl_certificate /var/www/cert/github.com+1.pem;
        ssl_certificate_key /var/www/cert/github.com+1-key.pem;
    
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        ssl_session_tickets off;

        client_max_body_size 2G;  
        error_page 497 https://$host$request_uri;
        proxy_ssl_server_name on;
        location / {
            proxy_pass https://pushraw.so169.com;
        }
    }
    server {
        listen 127.0.0.1:443 ssl;
        server_name github.com;
        ssl_certificate /var/www/cert/github.com+1.pem;
        ssl_certificate_key /var/www/cert/github.com+1-key.pem;

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        ssl_session_tickets off;

        proxy_ssl_server_name on;
        proxy_cookie_domain github.com pushfast.so169.com;
        client_max_body_size 2G;
        error_page 497 https://$host$request_uri;
        error_page 497 https://$host$request_uri;
        location / {
            proxy_pass https://pushfast.so169.com;
        }
    }
    server {
        listen 127.0.0.1:443 ssl;
        server_name ghcr.io;
        ssl_certificate /var/www/cert/github.com+1.pem;
        ssl_certificate_key /var/www/cert/github.com+1-key.pem;
    
        ssl_protocols TLSv1.2 TLSv1.3;
        #ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        ssl_session_tickets off;
        
        client_max_body_size 2G;
        error_page 497 https://$host$request_uri;

        location / {
            proxy_set_header Access-Control-Allow-Origin *;
            proxy_redirect https://pkg-containers.githubusercontent.com https://ghcr.nju.edu.cn;
            proxy_pass https://ghcr.nju.edu.cn;
        }
  }
}
events {}
